<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 900">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #2c3e50; }
      .subtitle { font: 14px sans-serif; fill: #34495e; }
      .table-name { font: bold 16px sans-serif; fill: white; }
      .field-name { font: 13px monospace; fill: #2c3e50; }
      .field-type { font: 12px monospace; fill: #7f8c8d; }
      .pk { font: bold 12px sans-serif; fill: #e74c3c; }
      .index { font: 11px sans-serif; fill: #3498db; }
      .table-header { fill: #34495e; }
      .table-body { fill: #ecf0f1; stroke: #34495e; stroke-width: 2; }
      .relation { stroke: #e74c3c; stroke-width: 2; fill: none; stroke-dasharray: 5,5; }
      .vector-highlight { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; }
    </style>
    <marker id="fk-arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title">Database Schema - PostgreSQL with pgvector</text>
  <text x="700" y="65" text-anchor="middle" class="subtitle">Multi-Tenant Recommendation System</text>
  
  <!-- Entities Table -->
  <g id="entities-table">
    <rect x="50" y="100" width="350" height="40" class="table-header"/>
    <text x="225" y="125" text-anchor="middle" class="table-name">entities</text>
    
    <rect x="50" y="140" width="350" height="280" class="table-body"/>
    
    <text x="60" y="165" class="field-name">entity_id</text>
    <text x="250" y="165" class="field-type">VARCHAR(255)</text>
    <text x="360" y="165" class="pk">PK</text>
    
    <text x="60" y="190" class="field-name">entity_type</text>
    <text x="250" y="190" class="field-type">VARCHAR(100)</text>
    <text x="360" y="190" class="pk">PK</text>
    
    <text x="60" y="215" class="field-name">tenant_id</text>
    <text x="250" y="215" class="field-type">VARCHAR(255)</text>
    <text x="360" y="215" class="pk">PK</text>
    
    <text x="60" y="240" class="field-name">attributes</text>
    <text x="250" y="240" class="field-type">JSONB</text>
    
    <rect x="55" y="250" width="340" height="25" rx="3" class="vector-highlight"/>
    <text x="60" y="268" class="field-name">feature_vector</text>
    <text x="250" y="268" class="field-type">vector(512)</text>
    
    <text x="60" y="295" class="field-name">created_at</text>
    <text x="250" y="295" class="field-type">TIMESTAMPTZ</text>
    
    <text x="60" y="320" class="field-name">updated_at</text>
    <text x="250" y="320" class="field-type">TIMESTAMPTZ</text>
    
    <text x="60" y="350" class="index">📊 idx_entities_type</text>
    <text x="60" y="370" class="index">📊 idx_entities_created_at</text>
    <text x="60" y="390" class="index">🔍 idx_entities_feature_vector_hnsw</text>
    <text x="60" y="410" class="subtitle">(HNSW for vector similarity)</text>
  </g>
  
  <!-- Interactions Table -->
  <g id="interactions-table">
    <rect x="525" y="100" width="350" height="40" class="table-header"/>
    <text x="700" y="125" text-anchor="middle" class="table-name">interactions</text>
    
    <rect x="525" y="140" width="350" height="320" class="table-body"/>
    
    <text x="535" y="165" class="field-name">id</text>
    <text x="725" y="165" class="field-type">BIGSERIAL</text>
    <text x="835" y="165" class="pk">PK</text>
    
    <text x="535" y="190" class="field-name">user_id</text>
    <text x="725" y="190" class="field-type">VARCHAR(255)</text>
    <text x="835" y="190" class="pk">FK</text>
    
    <text x="535" y="215" class="field-name">entity_id</text>
    <text x="725" y="215" class="field-type">VARCHAR(255)</text>
    <text x="835" y="215" class="pk">FK</text>
    
    <text x="535" y="240" class="field-name">entity_type</text>
    <text x="725" y="240" class="field-type">VARCHAR(100)</text>
    
    <text x="535" y="265" class="field-name">tenant_id</text>
    <text x="725" y="265" class="field-type">VARCHAR(255)</text>
    
    <text x="535" y="290" class="field-name">interaction_type</text>
    <text x="725" y="290" class="field-type">VARCHAR(50)</text>
    
    <text x="535" y="315" class="field-name">weight</text>
    <text x="725" y="315" class="field-type">FLOAT</text>
    
    <text x="535" y="340" class="field-name">metadata</text>
    <text x="725" y="340" class="field-type">JSONB</text>
    
    <text x="535" y="365" class="field-name">timestamp</text>
    <text x="725" y="365" class="field-type">TIMESTAMPTZ</text>
    
    <text x="535" y="395" class="index">📊 idx_interactions_user</text>
    <text x="535" y="415" class="index">📊 idx_interactions_entity</text>
    <text x="535" y="435" class="index">📊 idx_interactions_timestamp</text>
  </g>
  
  <!-- User Profiles Table -->
  <g id="user-profiles-table">
    <rect x="1000" y="100" width="350" height="40" class="table-header"/>
    <text x="1175" y="125" text-anchor="middle" class="table-name">user_profiles</text>
    
    <rect x="1000" y="140" width="350" height="280" class="table-body"/>
    
    <text x="1010" y="165" class="field-name">user_id</text>
    <text x="1200" y="165" class="field-type">VARCHAR(255)</text>
    <text x="1310" y="165" class="pk">PK</text>
    
    <text x="1010" y="190" class="field-name">tenant_id</text>
    <text x="1200" y="190" class="field-type">VARCHAR(255)</text>
    <text x="1310" y="190" class="pk">PK</text>
    
    <rect x="1005" y="200" width="340" height="25" rx="3" class="vector-highlight"/>
    <text x="1010" y="218" class="field-name">preference_vector</text>
    <text x="1200" y="218" class="field-type">vector(512)</text>
    
    <text x="1010" y="243" class="field-name">interaction_count</text>
    <text x="1200" y="243" class="field-type">INT</text>
    
    <text x="1010" y="268" class="field-name">last_interaction_at</text>
    <text x="1200" y="268" class="field-type">TIMESTAMPTZ</text>
    
    <text x="1010" y="293" class="field-name">created_at</text>
    <text x="1200" y="293" class="field-type">TIMESTAMPTZ</text>
    
    <text x="1010" y="318" class="field-name">updated_at</text>
    <text x="1200" y="318" class="field-type">TIMESTAMPTZ</text>
    
    <text x="1010" y="348" class="index">📊 idx_user_profiles_interaction_count</text>
    <text x="1010" y="368" class="index">🔍 idx_user_profiles_preference_vector_hnsw</text>
    <text x="1010" y="388" class="subtitle">(HNSW for user similarity)</text>
  </g>
  
  <!-- Trending Entities Table -->
  <g id="trending-table">
    <rect x="525" y="520" width="350" height="40" class="table-header"/>
    <text x="700" y="545" text-anchor="middle" class="table-name">trending_entities</text>
    
    <rect x="525" y="560" width="350" height="260" class="table-body"/>
    
    <text x="535" y="585" class="field-name">entity_id</text>
    <text x="725" y="585" class="field-type">VARCHAR(255)</text>
    <text x="835" y="585" class="pk">PK</text>
    
    <text x="535" y="610" class="field-name">entity_type</text>
    <text x="725" y="610" class="field-type">VARCHAR(100)</text>
    
    <text x="535" y="635" class="field-name">tenant_id</text>
    <text x="725" y="635" class="field-type">VARCHAR(255)</text>
    <text x="835" y="635" class="pk">PK</text>
    
    <text x="535" y="660" class="field-name">score</text>
    <text x="725" y="660" class="field-type">FLOAT</text>
    
    <text x="535" y="685" class="field-name">window_start</text>
    <text x="725" y="685" class="field-type">TIMESTAMPTZ</text>
    <text x="835" y="685" class="pk">PK</text>
    
    <text x="535" y="710" class="field-name">window_end</text>
    <text x="725" y="710" class="field-type">TIMESTAMPTZ</text>
    
    <text x="535" y="740" class="index">📊 idx_trending_lookup</text>
    <text x="535" y="760" class="index">📊 idx_trending_window_end</text>
    <text x="535" y="780" class="subtitle">(Cache for cold start)</text>
  </g>
  
  <!-- Relationships -->
  <path d="M 400 215 L 525 215" class="relation" marker-end="url(#fk-arrow)"/>
  <text x="450" y="210" class="subtitle">references</text>
  
  <path d="M 700 460 L 700 520" class="relation" marker-end="url(#fk-arrow)"/>
  <text x="710" y="495" class="subtitle">aggregates to</text>
  
  <path d="M 875 190 L 1000 190" class="relation" marker-end="url(#fk-arrow)"/>
  <text x="920" y="185" class="subtitle">builds profile</text>
  
  <!-- Legend -->
  <rect x="50" y="520" width="400" height="180" rx="5" class="table-body"/>
  <text x="250" y="545" text-anchor="middle" class="table-name" style="fill: #2c3e50;">Legend</text>
  
  <rect x="60" y="560" width="100" height="20" rx="3" class="vector-highlight"/>
  <text x="170" y="575" class="field-name">Vector columns (512-dim)</text>
  
  <text x="60" y="600" class="pk">PK</text>
  <text x="90" y="600" class="field-name">= Primary Key</text>
  
  <text x="60" y="625" class="pk">FK</text>
  <text x="90" y="625" class="field-name">= Foreign Key</text>
  
  <text x="60" y="650" class="index">📊</text>
  <text x="90" y="650" class="field-name">= B-tree Index</text>
  
  <text x="60" y="675" class="index">🔍</text>
  <text x="90" y="675" class="field-name">= HNSW Vector Index</text>
  
  <!-- Notes -->
  <rect x="50" y="730" width="400" height="140" rx="5" class="table-body"/>
  <text x="250" y="755" text-anchor="middle" class="table-name" style="fill: #2c3e50;">Key Features</text>
  <text x="60" y="780" class="subtitle">• Multi-tenancy via tenant_id in all tables</text>
  <text x="60" y="805" class="subtitle">• Vector similarity using pgvector extension</text>
  <text x="60" y="830" class="subtitle">• HNSW indexes for sub-linear search time</text>
  <text x="60" y="855" class="subtitle">• Composite primary keys for data isolation</text>
</svg>